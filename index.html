<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Pong z Menu</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #000;
      font-family: sans-serif;
      color: white;
    }
    canvas {
      display: block;
      margin: auto;
      background: #111;
    }
    #menu {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.8);
      z-index: 10;
    }
    .btn {
      padding: 15px 30px;
      margin: 10px;
      font-size: 20px;
      background: #333;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      transition: 0.3s;
    }
    .btn:hover {
      background: #555;
    }
    #timer {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 24px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>PONG</h1>
    <button class="btn" onclick="startGame('bot')">Graj z botem</button>
    <button class="btn" onclick="startGame('1v1')">1 vs 1 (dwóch graczy)</button>
  </div>

  <div id="timer">Czas: 0</div>
  <canvas id="pong" width="800" height="500"></canvas>

<script>
  const canvas = document.getElementById("pong");
  const ctx = canvas.getContext("2d");

  const timerDisplay = document.getElementById("timer");
  const scoreboard = document.getElementById("scoreboard");
  const backBtn = document.getElementById("backBtn");
  const menu = document.getElementById("menu");

  const paddleWidth = 10, paddleHeight = 100;
  let gameMode = "bot";
  let gameStarted = false;
  let timeElapsed = 0;
  let intervalId;

  let score1 = 0;
  let score2 = 0;

  const player1 = {
    x: 0,
    y: canvas.height / 2 - paddleHeight / 2,
    width: paddleWidth,
    height: paddleHeight,
    color: "white",
    dy: 0
  };

  const player2 = {
    x: canvas.width - paddleWidth,
    y: canvas.height / 2 - paddleHeight / 2,
    width: paddleWidth,
    height: paddleHeight,
    color: "white",
    dy: 0
  };

  const ball = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    radius: 7,
    baseSpeed: 5,
    speed: 5,
    dx: 5,
    dy: 5,
    color: "white"
  };

  function drawRect(x, y, w, h, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, w, h);
  }

  function drawCircle(x, y, r, color) {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.closePath();
    ctx.fill();
  }

  function drawNet() {
    for (let i = 0; i < canvas.height; i += 15) {
      drawRect(canvas.width / 2 - 1, i, 2, 10, "white");
    }
  }

  function draw() {
    drawRect(0, 0, canvas.width, canvas.height, "#111");
    drawNet();
    drawRect(player1.x, player1.y, player1.width, player1.height, player1.color);
    drawRect(player2.x, player2.y, player2.width, player2.height, player2.height, player2.color);
    drawCircle(ball.x, ball.y, ball.radius, ball.color);
  }

  function update() {
    ball.x += ball.dx;
    ball.y += ball.dy;

    if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) {
      ball.dy *= -1;
    }

    if (ball.x - ball.radius < player1.x + player1.width &&
        ball.y > player1.y && ball.y < player1.y + player1.height) {
      ball.dx = Math.abs(ball.dx);
    }

    if (ball.x + ball.radius > player2.x &&
        ball.y > player2.y && ball.y < player2.y + player2.height) {
      ball.dx = -Math.abs(ball.dx);
    }

    player1.y += player1.dy;
    player1.y = Math.max(0, Math.min(canvas.height - player1.height, player1.y));

    if (gameMode === "bot") {
      if (player2.y + player2.height / 2 < ball.y) {
        player2.y += 3;
      } else {
        player2.y -= 3;
      }
    } else {
      player2.y += player2.dy;
      player2.y = Math.max(0, Math.min(canvas.height - player2.height, player2.y));
    }

    // Gole
    if (ball.x < 0) {
      score2++;
      checkWin();
      resetBall();
    }
    if (ball.x > canvas.width) {
      score1++;
      checkWin();
      resetBall();
    }

    updateScoreboard();
  }

  function updateScoreboard() {
    scoreboard.innerHTML = `Gracz 1: ${score1}<br>Gracz 2: ${score2}`;
  }

  function resetBall() {
    ball.x = canvas.width / 2;
    ball.y = canvas.height / 2;
    ball.speed = ball.baseSpeed;
    let angle = Math.random() * Math.PI * 2;
    ball.dx = Math.cos(angle) * ball.speed;
    ball.dy = Math.sin(angle) * ball.speed;
  }

  function checkWin() {
    if (score1 >= 5 || score2 >= 5) {
      gameStarted = false;
      clearInterval(intervalId);
      alert(`Wygrał ${score1 >= 5 ? "Gracz 1" : "Gracz 2"}!`);
      returnToMenu();
    }
  }

  function loop() {
    if (!gameStarted) return;
    update();
    draw();
    requestAnimationFrame(loop);
  }

  document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") player1.dy = -6;
    if (e.key === "ArrowDown") player1.dy = 6;

    if (gameMode === "1v1") {
      if (e.key === "w") player2.dy = -6;
      if (e.key === "s") player2.dy = 6;
    }
  });

  document.addEventListener("keyup", e => {
    if (e.key === "ArrowUp" || e.key === "ArrowDown") player1.dy = 0;

    if (gameMode === "1v1") {
      if (e.key === "w" || e.key === "s") player2.dy = 0;
    }
  });

  function startGame(mode) {
    gameMode = mode;
    menu.style.display = "none";
    backBtn.style.display = "block";
    gameStarted = true;
    score1 = 0;
    score2 = 0;
    timeElapsed = 0;
    updateScoreboard();
    timerDisplay.innerText = `Czas: 0`;
    resetBall();
    loop();
    startTimer();
  }

  function startTimer() {
    clearInterval(intervalId);
    intervalId = setInterval(() => {
      if (!gameStarted) return;
      timeElapsed++;
      timerDisplay.innerText = `Czas: ${timeElapsed}`;
      if (timeElapsed % 10 === 0) {
        ball.speed += 0.5;
        const angle = Math.atan2(ball.dy, ball.dx);
        ball.dx = Math.cos(angle) * ball.speed;
        ball.dy = Math.sin(angle) * ball.speed;
      }
    }, 1000);
  }

  function returnToMenu() {
    gameStarted = false;
    menu.style.display = "flex";
    backBtn.style.display = "none";
    clearInterval(intervalId);
  }
</script>
</body>
</html>
